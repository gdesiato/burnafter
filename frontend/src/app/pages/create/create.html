<div class="page">
  <div class="container">
    <h1>Create Message</h1>

    <form (ngSubmit)="submit()">
      <p>
        <label>Content</label>
        <div class="textarea-wrapper">
          <textarea [(ngModel)]="text" name="text" rows="12" required></textarea>
          <div class="counter" [style.color]="counterColor" aria-live="polite">
            {{ charCount | number }} / {{ maxChars | number }} <span class="muted">chars</span>
          </div>
        </div>

      <p>
        <label>Expires<br>
          <select [(ngModel)]="expiresIn" name="expiresIn">
            <option value="10min">10min</option>
            <option value="1h">1h</option>
            <option value="24h">24h</option>
            <option value="7d">7d</option>
          </select>
        </label>
        &nbsp;&nbsp;
        <label>Views (1–10)<br>
          <input type="number" min="1" max="10" [(ngModel)]="views" name="views">
        </label>
        &nbsp;&nbsp;
        <label>
          <input type="checkbox" [(ngModel)]="burnAfterRead" name="burnAfterRead">
          burn-after-read
        </label>
      </p>

      <p>
        <label>Password (optional)<br>
          <input type="password" [(ngModel)]="password" name="password">
        </label>
      </p>

      <p class="hint">
        no password ⇒ the link is the key. keep it safe.
      </p>

      <!-- disable submit if too long -->
      <button type="submit" [disabled]="loading || !text.trim() || overCharLimit">create</button>

      <div class="error" *ngIf="overCharLimit">
        Paste too long. Reduce by {{ charCount - maxChars }} characters.
      </div>

      @if (error) {
        <div class="error">error: {{ error }}</div>
      }

      <!-- ✅ UPDATED RESULT SECTION -->
      @if (resultUrl) {
        <div class="result-row">
          <input #resultInput [value]="resultUrl" readonly>

          <button type="button"
                  class="copy-btn"
                  (click)="copy()"
                  [class.copied]="copied"
                  aria-live="polite"
                  [attr.aria-label]="copied ? 'Copied!' : 'Copy link'">
            <span class="label">{{ copied ? 'Copied!' : 'Copy' }}</span>
            <svg class="check" viewBox="0 0 24 24" width="16" height="16">
              <path d="M20 6L9 17l-5-5"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="3"
                    stroke-linecap="round"
                    stroke-linejoin="round"/>
            </svg>
          </button>
        </div>

        <!-- Optional toast -->
        <div class="toast" *ngIf="copied" role="status">Link copied</div>
      }
    </form>
  </div>
</div>
